<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Doctor Dashboard - LT Hospital</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<!-- NAVBAR -->
<header class="navbar">
    <span class="hospital-name">LT Hospital</span>

    <ul class="menu">
        <li><a href="/home">Home</a></li>
        <li>
            <a href="/logout" style="color:red; font-weight:600;">Logout</a>
        </li>
    </ul>
</header>

<!-- DASHBOARD -->
<section class="section">
    <h2>Doctor Dashboard</h2>

    <button id="viewBtn" onclick="toggleAppointments()">
        View Appointments
    </button>

    <div id="appointments" style="margin-top:25px; display:none;"></div>
</section>

<footer>
    Â© 2026 LT Hospital. All Rights Reserved.
</footer>

<script>
let visible = false;

function toggleAppointments() {
    const container = document.getElementById("appointments");

    if (visible) {
        container.style.display = "none";
        document.getElementById("viewBtn").innerText = "View Appointments";
        visible = false;
    } else {
        loadAppointments();
        container.style.display = "block";
        document.getElementById("viewBtn").innerText = "Hide Appointments";
        visible = true;
    }
}

function loadAppointments() {
    fetch("/appointments")
        .then(res => {
            if (!res.ok) throw new Error("Failed to load appointments");
            return res.json();
        })
        .then(data => {
            let html = "";

            if (data.length === 0) {
                html = "<p>No appointments available.</p>";
            } else {
                data.forEach(app => {
                    const riskColor =
                        app.risk_level === "High Risk" ? "red" :
                        app.risk_level === "Medium Risk" ? "orange" : "green";

                    html += `
                        <div style="
                            border-left: 6px solid ${riskColor};
                            background: #f9f9f9;
                            padding: 15px;
                            margin-bottom: 15px;
                            border-radius: 8px;
                        ">
                            <p><b>Patient:</b> ${app.patient_name}</p>
                            <p><b>Risk:</b>
                                <span style="color:${riskColor}; font-weight:600;">
                                    ${app.risk_level}
                                </span>
                            </p>
                            <p><b>Priority:</b> ${app.priority}</p>
                            <p><b>Severity:</b> ${app.severity_score}</p>
                            <p><b>Symptoms:</b> ${app.symptoms.join(", ")}</p>

                            <button
                                style="margin-top:10px; background:#0b4f8a; color:white;"
                                onclick="deleteAppointment(${app.id})">
                                Mark as Consulted
                            </button>
                        </div>
                    `;
                });
            }

            document.getElementById("appointments").innerHTML = html;
        })
        .catch(err => {
            document.getElementById("appointments").innerHTML =
                "<p style='color:red;'>Error loading appointments</p>";
            console.error(err);
        });
}

function deleteAppointment(id) {
    if (!confirm("Confirm consultation completed?")) return;

    fetch(`/delete-appointment/${id}`, {
        method: "DELETE"
    })
    .then(res => {
        if (!res.ok) throw new Error("Delete failed");
        return res.json();
    })
    .then(data => {
        alert(data.message);
        loadAppointments();
    })
    .catch(err => {
        alert("Error deleting appointment");
        console.error(err);
    });
}
</script>

</body>
</html>
